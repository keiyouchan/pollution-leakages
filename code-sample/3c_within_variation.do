global migration "/Users/chandlerwong/Desktop/Pollution_project"	global scripts "$migration/code_scripts"	global data "$migration/data"		global raw "$data/raw"		global interm "$data/intermediate"		global processed "$data/processed"	global output "$migration/output"		global baseline   "$output/baseline"		global robust     "$output/robust"		global hetero     "$output/hetero"		global eventstudy "$output/eventstudy"			global mechanism  "$output/mechanism"		global destin     "$output/destination"cd $processed*************************************clearuse "$processed/firm_reg_balance.dta", clear* gen provXyear = provcode * yeargen induXyear = indusid  * yearkeep code provcode indusid year provXyear induXyear treatment policysort code provXyear induXyearcap program drop cal_within_variprogram cal_within_vari		version 18		syntax varlist, group(varlist)		local varname `varlist'		* - 总体方差		qui: summarize `varname'		scalar var_total = r(Var)		* - 组内方差		cap drop `varname'_mean 		cap drop `varname'_within		bysort `group': egen `varname'_mean = mean(`varname') // 组内均值		gen `varname'_within = `varname' - `varname'_mean     // 去均值后		qui: summarize `varname'_within 		scalar var_within = r(Var)		cap drop `varname'_mean `varname'_within		* - 计算两者比值		display var_within / var_totalend cal_within_vari policy, group(code provcode )*================ cal within R-square ===============*reghdfe policy, absorb(code indusid#year provcode#year) residreghdfe policy i.provcode#year i.indusid#year, absorb(code) residpredict treat_resid, residreghdfe policy, a(code year)est sto ret1reghdfe policy, a(code indusid#year)est sto ret2reghdfe policy, a(code provcode#year)est sto ret3reghdfe policy, a(code indusid#year provcode#year)est sto ret4esttab ret1 ret2 ret3 ret4 using "$robust/over_spec_risk.csv", replace  ///	ar2(3) noline compress nogaps ///	addnotes("Firm FE, Yes, Yes, Yes, Yes"  ///			 "Year FE, Yes, Yes, Yes, Yes" ///			 "Industry-by-Year FE, ,Yes , , Yes" ///		 	 "Province-by-Year FE, , , Yes, Yes" ) * 原始方差summarize policyscalar var_total = r(Var)* FE 后剩余方差summarize treat_residscalar var_resid = r(Var)* 剩余识别变异占比display var_resid / var_totalreghdfe stock_out policy, a($hdfe c.(firm_char_*)#year c.(city_char_*)#year) vce(cluster code)